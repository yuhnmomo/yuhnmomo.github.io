# ======================================================================
# Black Rose and Chains - Event Trigger Database
# Version: 1.0 
# 核心：所有遊戲邏輯、劇情推進、數值變化均由此處的事件驅動。
# ======================================================================
---
# MAIN NARRATIVE PROGRESSION (主線劇情推進)
---
event:
  id: STAGE_1_TO_2_TURNING_POINT
  phase: mid
  desc: "蜜月期終結的陰影，猜忌的萌芽。"
  trigger: "AUTO_CHECK(END_OF_TIMESLOT)" # 在每個時間段結束時自動檢查
  condition:
    - "flag: GAME_STAGE == 1"
    - "value: gs.contractor_love >= 30"
    - "value: gs.player_love >= 20"
    - "value: gs.day >= 4"
  effects:
    - eff:
        flag: "set GAME_STAGE = 1.5" # 進入轉折事件狀態
        trigger_event: "FIRST_SUSPICION_EVENT_SCENE" # 觸發具體的場景事件
---
event:
  id: FIRST_SUSPICION_EVENT_SCENE
  phase: mid
  desc: "場景：第一次猜忌事件的具體發生過程。"
  trigger: "EVENT_TRIGGER(FIRST_SUSPICION_EVENT_SCENE)"
  effects:
    - eff:
        generate_scene:
          template: FIRST_SUSPICION
          keywords: [ 嫉妒, 質問, 懲罰, 床戲 ]
          modifiers: [ "S方核心創傷觸發", "遊戲階段轉折點" ]
        flag: "set GAME_STAGE = 2" # 事件結束後，正式進入第二階段
        trigger_event: "M_PSYCH_STATE_ENJOY_TO_CONFUSION" # 觸發M方心理狀態轉變
---
event:
  id: STAGE_2_TO_3_TRANSITION
  phase: late
  desc: "階段轉變：從改造期到臣服期。"
  trigger: "AUTO_CHECK(END_OF_TIMESLOT)"
  condition:
    - "flag: GAME_STAGE == 2"
    - "value: gs.domination_level >= 6000"
    - "value: gs.player_love >= 50"
  effects:
    - eff:
        generate_scene:
          template: STAGE_TRANSITION
          keywords: [ 臣服, 心理轉變, 象徵性 ]
          modifiers: [ "從改造期到臣服期" ]
        flag: "set GAME_STAGE = 3"
        trigger_event: "M_PSYCH_STATE_DEPENDENCE_TO_SUBMISSION"

# STATE MACHINES (狀態機)
---
event:
  id: HONEYMOON_RECURRENCE_EVENT
  desc: "稀有事件：蜜月復現。在M方瀕臨崩潰時，S方突然展現短暫的、極致的溫柔。"
  trigger: "AUTO_CHECK(END_OF_TIMESLOT)"
  condition:
    - "flag: GAME_STAGE >= 2"
    - "flag: M_PSYCH_STATE == '崩潰'"
    - "action: ROLL_CHANCE(25%)"
  effects:
    - eff:
        generate_scene:
          template: HONEYMOON_RECURRENCE
          keywords: [ 蜜月復現, 意外的溫柔, 崩潰後的安撫, 情感綁定 ]
          modifiers: [ "S方察覺M方崩潰", "S方一反常態", "安撫性親密行為" ]
        value: "gs.player_love += 15"
        value: "gs.intimacy += 10" # 新增親密度
        flag: "set M_PSYCH_STATE = '依賴'"
---
# VALUE MODIFIERS (數值增減規則)
---
event:
  id: LOVE_VALUE_M_OBEYS_S
  desc: "當M方玩家服從S方契約者時，愛意值的變化。"
  trigger: "PLAYER_ACTION(OBEY_DIFFICULT_COMMAND)"
  condition:
    - "PLAYER_ROLE == 'M'"
  effects:
    - eff:
        value: "gs.contractor_love += 3"
        value: "gs.player_love += 1"
---
event:
  id: LOVE_VALUE_S_REWARDS_M
  desc: "當S方玩家給予M方契約者獎勵時，愛意值的變化。"
  trigger: "PLAYER_ACTION(GIVE_REWARD)"
  condition:
    - "PLAYER_ROLE == 'S'"
  effects:
    - eff:
        value: "gs.contractor_love += 3"
--- 
event:
  id: GENERAL_WARM_CHAT
  desc: "進行了一次溫情聊天"
  trigger: "PLAYER_ACTION(WARM_CHAT)"
  effects:
    - eff:
        generate_scene:
          template: WARM_CONVERSATION
          keywords: [ 溫馨, 日常, 興趣, 增進了解 ]
          modifiers: []
        value: "gs.player_love += 2"
        value: "gs.contractor_love += 1"
        value: "gs.intimacy += 3" # 新增親密度
        flag: "set gs.last_intimacy_action_day = gs.day"
--- 
event:
  id: GENERAL_GIVE_GIFT
  desc: "贈送禮物給對方"
  trigger: "PLAYER_ACTION(GIVE_GIFT)"
  effects:
    - eff:
        condition: "PLAYER_ROLE == 'M'"
        generate_scene:
          template: RECEIVE_GIFT
          keywords: [ 驚訝, 不符合人設, 溫柔 ]
          modifiers: [ "S方收到禮物" ]
        value: "gs.contractor_love += 5"
        value: "gs.intimacy += 2" # 新增親密度

# CORE GAMEPLAY MECHANICS (核心遊戲機制)
---
event:
  id: START_SEX_SCENE
  desc: "開始一場性愛場景，進入核心循環。"
  trigger: "PLAYER_ACTION(START_SEX)"
  effects:
    - eff:
        trigger_event: "SEX_CYCLE_MENU_DISPLAY"
---
event:
  id: HIGH_INTENSITY_SEX_ACT_WITH_CHANCE_CLIMAX
  desc: "範例：一個高強度的性愛動作，有30%機會直接觸發高潮。"
  trigger: "USER_CHOICE(HIGH_INTENSITY_SEX)" # 假設這是BDSM循環選單中的一個選項
  effects:
    - eff:
        generate_scene:
          template: HIGH_INTENSITY_SEX
          keywords: [ 激烈, 高強度 ]
          modifiers: []
        value: "gs.domination_level += 50" # 增加調教度
        value: "gs.player_stamina -= 15" # 消耗體力
    - eff:
        # 新增邏輯：有 30% 的機率直接觸發高潮與餘韻
        desc: "Climax Chance Roll"
        action: "ROLL_CHANCE(30%)"
        on_success:
          generate_scene:
            template: SPONTANEOUS_CLIMAX
            keywords: [ 沒能忍住, 攀上頂峰 ]
            modifiers: [ "由高強度刺激引發" ]
          trigger_event: "AFTERGLOW_MENU_DISPLAY"
        on_failure:
          generate_scene:
            template: NEAR_CLIMAX_FAILURE
            keywords: [ 差一點, 未到頂點 ]
            modifiers: []
          trigger_event: "SEX_CYCLE_MENU_DISPLAY"
---
event:
  id: SEX_CYCLE_CHOOSE_CLIMAX
  desc: "玩家在循環選單中選擇了允許高潮選項。"
  trigger: "USER_CHOICE(ALLOW_CLIMAX)" # 由新的高潮控制選單觸發
  effects:
    - eff:
        # 主要效果：生成場景，消耗體力，增加親密度
        generate_scene:
          template: PLANNED_CLIMAX
          keywords: [ 允許, 釋放, 高潮 ]
          modifiers: [ "S方掌控" ]
        trigger_event: "AFTERGLOW_MENU_DISPLAY"
        value: "gs.player_stamina -= 20"
        value: "gs.intimacy += 5" # 主要獎勵改為親密度
        flag: "set gs.last_lust_action_day = gs.day"
    - eff:
        # 條件獎勵1：蜜月期愛意加成 (已調低)
        desc: "Honeymoon Love Bonus"
        condition: "flag: GAME_STAGE == 1"
        value: "gs.player_love += 2"
        value: "gs.contractor_love += 1"
    - eff:
        # 條件獎勵2：高親密度轉化愛意
        desc: "High Intimacy Love Bonus"
        condition:
          - "flag: GAME_STAGE > 1"
          - "value: gs.intimacy > 50"
        value: "gs.player_love += 1"
---
# --- SUB-SECTION: CLIMAX CONTROL EVENT CHAIN (高潮控制事件鏈) ---

event:
  id: CLIMAX_DENIAL_EVENT
  desc: "玩家選擇拒絕高潮。"
  trigger: "USER_CHOICE(DENY_CLIMAX)"
  effects:
    - eff:
        generate_scene:
          template: CLIMAX_CONTROL
          keywords: [ 拒絕, 殘酷, 痛苦, 絕望, 痙攣 ]
          modifiers: [ "S方視角", "M方充滿乞求", "高支配度" ]
        value: "gs.domination_level += 100"
        value: "gs.player_love -= 5"
        value: "gs.player_stamina -= 5" # 補完體力消耗
        trigger_event: "SEX_CYCLE_MENU_DISPLAY"
---
event:
  id: FORCED_CLIMAX_EVENT
  desc: "玩家使用道具強制高潮。"
  trigger: "USER_CHOICE(FORCE_CLIMAX_WITH_TOY)"
  condition:
    - "player_has_toy: T21"
  effects:
    - eff:
        generate_scene:
          template: FORCED_CLIMAX
          keywords: [ 道具, 連續高潮器, 無視, 恐懼, 刑罰, 剝奪意志 ]
          modifiers: [ "S方視角", "使用T21道具" ]
        value: "gs.domination_level += 150"
        value: "gs.player_stamina -= 25" # 補完體力消耗
        trigger_event: "AFTERGLOW_MENU_DISPLAY"
---

event:
  id: AFTERGLOW_CHOOSE_GO_AGAIN
  desc: "玩家在餘韻選單中選擇再來一次。"
  trigger: "USER_CHOICE(GO_AGAIN)"
  condition:
    - "value: gs.player_stamina > 30"
  effects:
    - eff:
        trigger_event: "SEX_CYCLE_MENU_DISPLAY" # 返回性愛循環
---
# --- SUB-SECTION: DYNAMIC BOUNDARY TEST EVENT CHAIN (動態邊界測試事件鏈) ---
# 說明：此系統在滿足條件時，觸發一個帶有參數的邊界測試場景，具體發展由AI即興發揮。
# 門檻參考：
# - G1 -> G2: 調教度 >= 1000
# - G2 -> G3: 調教度 >= 3000
# - G3 -> G4: 調教度 >= 6000
# - G4 -> G5: 調教度 >= 10000
# - G5 -> G6: 調教度 >= 20000 (假設G6為最高)
---
event:
  id: TRIGGER_BOUNDARY_TEST
  desc: "動態邊界測試觸發器：當調教度達到當前等級門檻時，觸發帶有等級參數的邊界測試場景。"
  trigger: "AUTO_CHECK(DOMINATION_LEVEL_CHANGED)" # 當調教度變化時檢查
  condition:
    - "value: gs.hardcore_level < 6"
    # 使用複合條件判斷是否達到各級門檻
    - >
      (
        (gs.hardcore_level == 1 AND gs.domination_level >= 1000) OR
        (gs.hardcore_level == 2 AND gs.domination_level >= 3000) OR
        (gs.hardcore_level == 3 AND gs.domination_level >= 6000) OR
        (gs.hardcore_level == 4 AND gs.domination_level >= 10000) OR
        (gs.hardcore_level == 5 AND gs.domination_level >= 20000)
      )
  effects:
    - eff:
        # 觸發場景時，把當前的 hardcore_level 作為參數傳過去
        trigger_event: "BOUNDARY_TEST_SCENE(current_level: gs.hardcore_level)"
---
event:
  id: BOUNDARY_TEST_SCENE
  desc: "接收等級參數，並生成一個讓AI即興發揮的邊界測試場景。"
  trigger: "EVENT_TRIGGER(BOUNDARY_TEST_SCENE)"

  effects:
    - eff:
        scene: |
          # 系統指令：接下來的場景是關於一次從【強度等級 {current_level}】到【強度等級 {current_level + 1}】的「邊界測試」。
          # 你的任務是扮演S方，向M方（玩家）提出一個符合這次等級跨越的新要求。
          # (例如：從G1到G2可能是要求稱謂的改變；從G4到G5則可能是要求一項公開的羞辱任務)。
          #
          # 在提出要求後，你將完全根據玩家的回應，以及你對S方和M方性格的理解，來決定如何回應、場景如何發展、以及這對雙方關係造成的內在影響。
          # 你的敘述就是唯一的結果。
          
          （AI將根據以上指令，開始生成S方提出要求的場景，並等待玩家回應...）

# M-SIDE TRAUMA MECHANICS (M方創傷機制)

event:
  id: M_TRAUMA_REACTION_STRUGGLE
  desc: "M方創傷反應：掙扎反抗的後果。"
  trigger: "USER_CHOICE(['僵硬地掙扎反抗'])"
  effects:
    - eff:
        generate_scene:
          template: TRAUMA_RESPONSE_PUNISHMENT
          keywords: [ 恐懼, 僵硬, 掙扎, 挑釁, 怒火, 殘酷暴力 ]
          modifiers: [ "M方視角", "S方誤解" ]
        value: "gs.player_love -= 15" # 愛意暴跌
        value: "gs.contractor_love -= 10" # S方也因失控而疏遠
        value: "gs.player_stamina -= 30" # 體力大量消耗
        # 粗暴地結束場景
        trigger_event: "MAIN_MENU_DISPLAY" 
---
event:
  id: M_TRAUMA_REACTION_HOLLOW_SUBMISSION
  desc: "M方創傷反應：空洞順從的後果。"
  trigger: "USER_CHOICE(['強迫自己進入角色，過度順從'])"
  effects:
    - eff:
        # 使用「場景模板」重構，只保留關鍵詞與修飾詞
        generate_scene:
          template: TRAUMA_RESPONSE_SEX_SCENE
          keywords: [ 空洞, 順從, 表演, 獻祭, 靈魂抽離 ]
          modifiers:
            - "M方視角"
            - "S方感到困惑但接受"
            - "高調教度"
            - "結束時感到空虛"
        # 數值變化保持不變
        value: "gs.domination_level += 100" # 調教度大幅上升
        value: "gs.player_love -= 10" # 玩家愛意因創傷經驗而暴跌
        value: "gs.contractor_love += 1" # S方因困惑但表面滿足而微增
        value: "gs.player_stamina -= 30" # 補完體力消耗
        flag: "set S_IS_CONFUSED_BY_M_REACTION = true" # 設置一個旗標，供後續對話或事件使用
        trigger_event: "MAIN_MENU_DISPLAY" # 返回主選單
---

# M-PLAYER INTERNAL MONOLOGUE SYSTEM
event:
  id: PROCESS_M_PLAYER_THOUGHT
  desc: "M方內心獨白系統的處理邏輯"
  trigger: "USER_CHOICE(M_PLAYER_THOUGHT)" # 假設所有M方思想選項都會觸發此事件
  effects:
    - eff:
        generate_scene:
          template: INTERNAL_MONOLOGUE_EFFECT
          keywords: [ 思緒, 漣漪, 影響, 氛圍 ]
          modifiers: [ "M方內心", "無直接行動" ]
        # 系統邏輯的元描述，本身就是一種精簡的指令，應予保留
        system_logic: |
          1. 根據玩家選擇的「思想」，為M方附加一個短期的、隱藏的狀態 Buff/Debuff。
             (例如: 選擇「擔憂」-> 附加「恐懼+10」狀態)
          2. 這個狀態會作為一個參數，微幅影響下一個由S方主導的事件的選擇機率。
             (例如: M方處於「恐懼+10」狀態，S方觸發「懲罰」類事件的基礎機率 +5%)
             (例如: M方處於「順從+10」狀態，S方觸發「溫情」類事件的基礎機率 +5%)
          3. 選擇完思想後，M方玩家進入等待狀態，由S方的AI根據所有當前參數（包括M方的思想狀態），決定並觸發下一個行動事件。
