<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€Šå®¤å‹æˆ€æ„›æŒ‡å—ã€‹éŠæˆ²é–‹å ´è¨­å®š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Rose Gold Color Palette */
        :root {
            --rose-gold-light: #E6C2C2;
            --rose-gold-main: #D9A0A0;
            --rose-gold-dark: #C48A8A;
            --dark-bg: #1a1a1a;
            --dark-card: #2a2a2a;
            --dark-border: #444444;
            --dark-input: #333333;
            --text-light: #EAEAEA;
            --text-muted: #A0A0A0;
            --text-dark: #000000;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-light);
        }
        .step-card {
            background-color: var(--dark-card);
            border: 1px solid var(--dark-border);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .form-input {
            background-color: var(--dark-input);
            border: 2px solid var(--dark-border);
            color: var(--text-light);
            transition: border-color 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--rose-gold-main);
        }
        .form-input.invalid {
            border-color: #F87171;
        }
        .btn-primary {
            background-color: var(--rose-gold-main);
            color: var(--dark-bg);
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: var(--rose-gold-dark);
        }
        .btn-secondary {
            background-color: #4B5563;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #6B7280;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
        
        /* Text Card Radio Button Styles */
        .text-card-label { display: block; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s; }
        .text-card-content { background-color: var(--dark-input); border: 2px solid var(--dark-border); border-radius: 0.5rem; padding: 0.75rem 1rem; transition: all 0.2s; text-align: center; height: 100%; display: flex; align-items: center; justify-content: center; }
        .text-card-label:hover .text-card-content { border-color: #6B7280; }
        .text-card-text { color: var(--text-light); transition: color 0.2s ease-in-out; }
        .text-card-label input[type="radio"]:checked + .text-card-content { border-color: var(--rose-gold-dark); background-color: var(--rose-gold-main); }
        .text-card-label input[type="radio"]:checked + .text-card-content .text-card-text { color: var(--text-dark); font-weight: 500; }
        
        /* Card Grid Styles */
        .card-grid {
            display: grid;
            gap: 1rem;
            padding: 4px;
        }
        .appearance-grid {
             grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        }
        .zodiac-grid {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
        .icon-grid {
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }
        .text-card-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }

        .card-label { cursor: pointer; }
        .card { background-color: var(--dark-input); border: 2px solid var(--dark-border); border-radius: 0.5rem; overflow: hidden; transition: all 0.2s ease-in-out; position: relative; }
        .card:hover { border-color: var(--rose-gold-main); transform: translateY(-4px); }
        .card img { width: 100%; height: 160px; object-fit: cover; }
        .card-content { padding: 0.75rem; text-align: center; }
        .card-title { font-weight: 600; color: var(--text-light); margin-bottom: 0.5rem; font-size: 0.9rem; }
        .card-desc { font-size: 0.75rem; color: var(--text-muted); line-height: 1.6; }
        .card-label input:checked + .card { border-color: var(--rose-gold-dark); box-shadow: 0 0 15px rgba(217, 160, 160, 0.4); }
        .check-icon { position: absolute; top: 0.5rem; right: 0.5rem; width: 1.5rem; height: 1.5rem; background-color: var(--rose-gold-main); border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transform: scale(0.5); transition: all 0.2s ease-in-out; }
        .card-label input:checked + .card .check-icon { opacity: 1; transform: scale(1); }
        
        .zodiac-emoji { font-size: 3rem; height: 120px; display: flex; align-items: center; justify-content: center; }
        .icon-emoji { font-size: 2.5rem; height: 80px; display: flex; align-items: center; justify-content: center; }

        /* Summary Page Styles */
        .summary-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        @media (min-width: 640px) { .summary-grid { grid-template-columns: 1fr 1fr; } }
        .summary-card { background-color: var(--dark-input); border-radius: 0.5rem; padding: 1rem; border: 1px solid var(--dark-border); }
        .summary-card img { 
            width: 100%; 
            aspect-ratio: 1 / 1; 
            object-fit: cover; 
            border-radius: 0.25rem; 
            margin-bottom: 1rem; 
        }
        .summary-title { font-size: 1.25rem; font-weight: bold; color: var(--rose-gold-light); margin-bottom: 1rem; }
        .summary-details p { font-size: 0.875rem; margin-bottom: 0.5rem; }
        .summary-details span { color: var(--text-muted); margin-right: 0.5rem; }

    </style>
</head>
<body>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4">
            <div class="w-full md:w-auto order-2 md:order-1">
                 <a href="/roles.html" class="btn-secondary text-white font-bold py-2 px-4 rounded-lg text-sm w-full block text-center md:w-auto">
                    è¿”å›è§’è‰²é 
                </a>
            </div>
            <div class="text-center order-1 md:order-2">
                <h1 class="text-3xl sm:text-4xl font-bold" style="color: var(--rose-gold-light);">ã€Šå®¤å‹æˆ€æ„›æŒ‡å—ã€‹</h1>
                <p style="color: var(--text-muted);" class="mt-2">éŠæˆ²é–‹å ´èˆ‡è§’è‰²ç”Ÿæˆ</p>
            </div>
            <div class="hidden md:block order-3" style="width: 120px;"></div>
        </header>

        <main id="game-setup-container">
            <!-- Step 1: Player Info -->
            <div id="step-1" class="step active">
                <div class="step-card rounded-lg p-6 sm:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-6" style="color: var(--rose-gold-light);">1. ç©å®¶èº«ä»½è¨­å®š</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">æ€§åˆ¥</label>
                            <div id="playerGender" class="card-grid icon-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">æ€§å‘</label>
                            <div id="playerSexuality" class="card-grid icon-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">æ˜Ÿåº§</label>
                            <div id="playerZodiac" class="card-grid zodiac-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">è¡€å‹</label>
                            <div id="playerBloodType" class="card-grid icon-grid"></div>
                        </div>
                        <p class="text-sm pt-2" style="color: var(--text-muted);">ä½ çš„è·æ¥­é è¨­ç‚ºï¼šæ•¸ä½éŠç‰§ (ä»¥ç­†é›»é ç«¯å·¥ä½œï¼Œä½œæ¯å½ˆæ€§)ã€‚</p>
                    </div>
                    <div class="mt-8 flex justify-end items-center gap-4">
                        <button onclick="nextStep()" class="btn-primary font-bold py-2 px-6 rounded-lg">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Player Appearance -->
            <div id="step-2" class="step">
                <div class="step-card rounded-lg p-6 sm:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-6" style="color: var(--rose-gold-light);">2. ç©å®¶å¤–è§€è¨­å®š</h2>
                    <div id="playerAppearance" class="card-grid appearance-grid"></div>
                    <div class="mt-8 flex justify-between">
                        <button onclick="prevStep()" class="btn-secondary text-white font-bold py-2 px-6 rounded-lg">è¿”å›</button>
                        <button onclick="nextStep()" class="btn-primary font-bold py-2 px-6 rounded-lg">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Roommate Info -->
            <div id="step-3" class="step">
                <div class="step-card rounded-lg p-6 sm:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-6" style="color: var(--rose-gold-light);">3. å®¤å‹è¨‚è£½</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">æ€§åˆ¥</label>
                            <div id="roommateGender" class="card-grid icon-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">æ˜Ÿåº§</label>
                            <div id="roommateZodiac" class="card-grid zodiac-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">è¡€å‹</label>
                            <div id="roommateBloodType" class="card-grid icon-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">è·æ¥­</label>
                            <div id="roommateProfession" class="card-grid icon-grid"></div>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-between items-center">
                        <button onclick="prevStep()" class="btn-secondary text-white font-bold py-2 px-6 rounded-lg">è¿”å›</button>
                        <button onclick="nextStep()" class="btn-primary font-bold py-2 px-6 rounded-lg">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Roommate Appearance -->
            <div id="step-4" class="step">
                <div class="step-card rounded-lg p-6 sm:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-6" style="color: var(--rose-gold-light);">4. å®¤å‹å¤–è§€è¨­å®š</h2>
                    <div id="roommateAppearance" class="card-grid appearance-grid"></div>
                    <div class="mt-8 flex justify-between">
                        <button onclick="prevStep()" class="btn-secondary text-white font-bold py-2 px-6 rounded-lg">è¿”å›</button>
                        <button onclick="nextStep()" class="btn-primary font-bold py-2 px-6 rounded-lg">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Relationship, Names & Nickname -->
            <div id="step-5" class="step">
                <div class="step-card rounded-lg p-6 sm:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-6" style="color: var(--rose-gold-light);">5. é—œä¿‚èˆ‡å‘½å</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">åˆå§‹é—œä¿‚</label>
                            <p class="text-xs mb-2" style="color: var(--text-muted);">åœ¨é€™æ¬¡åˆç§Ÿä¹‹å‰ï¼Œä½ å’Œé€™ä½å³å°‡åˆ°ä¾†çš„å®¤å‹æ˜¯ä»€éº¼é—œä¿‚å‘¢ï¼Ÿ</p>
                            <div id="initialRelationship" class="card-grid text-card-grid"></div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">è¦ªå¯†è¡Œç‚ºé¢¨æ ¼</label>
                            <div id="roommateIntimacy" class="card-grid icon-grid"></div>
                        </div>
                        <div>
                            <label for="playerName" class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">ä½ çš„åå­—</label>
                            <input type="text" id="playerName" class="form-input w-full rounded-lg p-2.5" placeholder="è«‹è¼¸å…¥å§“å" maxlength="6">
                            <p class="text-xs mt-1" style="color: var(--text-muted);">æœ€å¤š6å€‹å­—</p>
                        </div>
                        <div>
                            <label for="roommateName" class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">å®¤å‹çš„åå­—</label>
                            <input type="text" id="roommateName" class="form-input w-full rounded-lg p-2.5" placeholder="è«‹è¼¸å…¥å§“å" maxlength="6">
                             <p class="text-xs mt-1" style="color: var(--text-muted);">æœ€å¤š6å€‹å­—</p>
                        </div>
                        <div>
                            <label for="roommateNickname" class="block mb-2 text-sm font-medium" style="color: var(--text-muted);">å®¤å‹å°ä½ çš„ç¨±å‘¼</label>
                            <input type="text" id="roommateNickname" class="form-input w-full rounded-lg p-2.5" placeholder="ä¾‹å¦‚ï¼šä½ çš„åå­—ã€å°åç­‰" maxlength="6">
                             <p class="text-xs mt-1" style="color: var(--text-muted);">æœ€å¤š6å€‹å­—</p>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-between items-center">
                        <button onclick="prevStep()" class="btn-secondary text-white font-bold py-2 px-6 rounded-lg">è¿”å›</button>
                        <div class="flex items-center gap-4">
                            <p class="error-message text-red-400 text-sm h-5"></p>
                            <button onclick="showSummary()" class="btn-primary font-bold py-2 px-6 rounded-lg">å®Œæˆè¨­å®š</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 6: Summary & Download -->
            <div id="step-6" class="step">
                <div class="step-card rounded-lg p-6 sm:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-6" style="color: var(--rose-gold-light);">æœ€çµ‚ç¢ºèª</h2>
                    <div id="summary-visual" class="summary-grid mb-6">
                        <!-- Visual summary will be injected here -->
                    </div>
                    <h3 class="text-lg font-semibold mb-2" style="color: var(--rose-gold-light);">æ•¸æ“šå½™ç¸½ (å‡ºåœ–ç”¨)</h3>
                    <div class="rounded-lg p-4 text-sm leading-relaxed whitespace-pre-wrap" id="summary-output" style="background-color: var(--dark-bg); color: var(--text-light);">
                        <!-- Text summary will be injected here -->
                    </div>
                    <div class="mt-8 flex flex-col sm:flex-row justify-between gap-4">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="goToStep(1)" class="btn-secondary text-white text-sm font-bold py-2 px-4 rounded-lg">ä¿®æ”¹ç©å®¶è³‡æ–™</button>
                            <button onclick="goToStep(2)" class="btn-secondary text-white text-sm font-bold py-2 px-4 rounded-lg">ä¿®æ”¹ç©å®¶å¤–è§€</button>
                            <button onclick="goToStep(3)" class="btn-secondary text-white text-sm font-bold py-2 px-4 rounded-lg">ä¿®æ”¹å®¤å‹è³‡æ–™</button>
                            <button onclick="goToStep(4)" class="btn-secondary text-white text-sm font-bold py-2 px-4 rounded-lg">ä¿®æ”¹å®¤å‹å¤–è§€</button>
                            <button onclick="goToStep(5)" class="btn-secondary text-white text-sm font-bold py-2 px-4 rounded-lg">ä¿®æ”¹é—œä¿‚èˆ‡å‘½å</button>
                        </div>
                        <button onclick="downloadTxt()" class="btn-primary font-bold py-2 px-6 rounded-lg w-full sm:w-auto mt-4 sm:mt-0">ä¸‹è¼‰è¨­å®šæª” (.txt)</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- DATA FROM åƒæ•¸è¨­å®šè³‡æ–™æª”.txt ---
        const gameData = {
            gender: [ { code: 'G01', text: 'ç”·', symbol: 'â™‚ï¸' }, { code: 'G02', text: 'å¥³', symbol: 'â™€ï¸' } ],
            sexuality: [ { code: 'X01', text: 'åƒ…å–œæ­¡ç”·æ€§', symbol: 'â™‚ï¸' }, { code: 'X02', text: 'åƒ…å–œæ­¡å¥³æ€§', symbol: 'â™€ï¸' }, { code: 'X03', text: 'ä¸é™', symbol: 'ğŸŒˆ' } ],
            appearance: {
                female: [
                    { code: 'F01', text: 'è¼•å¥¢ååª›ç³»(é«®å‹:æ³¢æµªæ² æœè£:å‰ªè£å¾—é«”çš„é€£èº«è£™ æ°£è³ª:å„ªé›…å¤§æ–¹ã€è«‡åå¾å®¹)' }, { code: 'F02', text: 'é„°å®¶å¥³å­©ç³»(é«®å‹:åŠè‚©ç›´é«® æœè£:ç°¡ç´„Tæ¤é…ç‰›ä»”è¤² æ°£è³ª:è¦ªåˆ‡éš¨å’Œã€ç¬‘å®¹ç”œç¾)' }, { code: 'F03', text: 'çŸ¥æ€§é€šå‹¤ç³»(é«®å‹:é•·ç›´é«® æœè£:è¥¯è¡«é…çª„è£™ æ°£è³ª:æ²‰ç©©å¹¹ç·´ã€ç†æ€§æŸ”å’Œ)' }, { code: 'F04', text: 'ç”œç¾å°‘å¥³ç³»(é«®å‹:é›™é¦¬å°¾ æœè£:çŸ­è£™é…è´è¶çµä¸Šè¡£ æ°£è³ª:æ´»æ½‘å¯æ„›ã€å……æ»¿å…ƒæ°£)' }, { code: 'F05', text: 'é‹å‹•æ´»åŠ›ç³»(é«®å‹:é«˜é¦¬å°¾ æœè£:é‹å‹•å¤–å¥—èˆ‡çŸ­è¤² æ°£è³ª:å¥åº·é™½å…‰ã€æœæ°£åè¶³)' }, { code: 'F06', text: 'å­¸é™¢æ–‡é’ç³»(é«®å‹:é½Šç€æµ·çŸ­é«® æœè£:é‡ç¹”å¤–å¥—é…ç™¾è¤¶è£™ æ°£è³ª:å®‰éœå…§æ–‚ã€æ›¸å·æ°£æ¿ƒ)' }, { code: 'F07', text: 'ç°¡ç´„æ¸…æ–°ç³»(é«®å‹:ä¸­é•·ç›´é«® æœè£:ç´ è‰²ä¸Šè¡£é…é•·è¤² æ°£è³ª:è‡ªç„¶éš¨æ€§ã€ä¹¾æ·¨ä¿è½)' }, { code: 'F08', text: 'è¼•ç†Ÿæº«æŸ”ç³»(é«®å‹:ä¸­é•·å¾®æ² æœè£:é‡ç¹”è¡«é…é•·è£™ æ°£è³ª:é«”è²¼æº«æš–ã€ç¬‘å®¹æŸ”å’Œ)' }, { code: 'F09', text: 'è¡—é ­ä¼‘é–’ç³»(é«®å‹:è“¬é¬†çŸ­é«® æœè£:å¯¬é¬†Tæ¤é…å·¥è£è¤² æ°£è³ª:è‡ªä¿¡ç‘è„«ã€æ´»æ½‘çˆ½æœ—)' }, { code: 'F10', text: 'æ—¥ç³»æ£®å¥³ç³»(é«®å‹:ä¸­é•·æ²é«® æœè£:å¯¬é¬†é€£è¡£è£™é…è‰å¸½ æ°£è³ª:æ¬éœæ–‡é›…ã€æº«å©‰å¯è¦ª)' }, { code: 'F11', text: 'æ™‚å°šç™½é ˜ç³»(é«®å‹:å´åˆ†ç›´é«® æœè£:è¥¿è£å¤–å¥—é…é•·è¤² æ°£è³ª:å¹¹ç·´åˆ©è½ã€å“å‘³å‡ºçœ¾)' }, { code: 'F12', text: 'æ–‡è—å‰µä½œç³»(é«®å‹:è‡ªç„¶äº‚é«® æœè£:åœè£™é…ä¼‘é–’è¤² æ°£è³ª:å°ˆæ³¨ç´°è†©ã€ç•¥å¸¶æ–‡è—æ°£æ¯)' }
                ],
                male: [
                    { code: 'M01', text: 'å•†å‹™ç²¾è‹±ç³»(é«®å‹:çŸ­å´åˆ† æœè£:å‰ªè£åˆèº«è¥¿è£ æ°£è³ª:æ²‰ç©©è‡ªä¿¡ã€è«‡åå¾—é«”)' }, { code: 'M02', text: 'æº«æŸ”è²´å…¬å­ç³»(é«®å‹:ä¸­é•·å¾®æ² æœè£:æ·ºè‰²è¥¯è¡«é…å¡å…¶é•·è¤² æ°£è³ª:ç¬‘å®¹æº«æš–ã€èˆ‰æ­¢å„ªé›…)' }, { code: 'M03', text: 'è¼•å¥¢é›…ç—ç³»(é«®å‹:å¾Œæ¢³æ²¹é ­ æœè£:é‡ç¹”å¤–å¥—é…çµ²è³ªè¥¯è¡« æ°£è³ª:é¢¨åº¦ç¿©ç¿©ã€å¸¶é»ä¸ç¾ˆ)' }, { code: 'M04', text: 'ä½èª¿åå“ç³»(é«®å‹:å¾®æ²çŸ­é«® æœè£:å“ç‰ŒPoloè¡«é…ä¿®èº«ä¼‘é–’è¤² æ°£è³ª:å…§æ–‚ç©©é‡ã€è¡£è‘—è€ƒç©¶)' }, { code: 'M05', text: 'è¼•å¥¢ä¼‘é–’ç³»(é«®å‹:è‡ªç„¶è“¬é¬†é«® æœè£:é«˜è³ªæ„Ÿé‡ç¹”è¡«é…ä¿®èº«é•·è¤² æ°£è³ª:éš¨å’Œæº«æš–ã€å“å‘³ä¸å¼µæš)' }, { code: 'M06', text: 'æ–‡é’å’–å•¡ç³»(é«®å‹:å¾®æ²ä¸­é•·é«® æœè£:å¯¬é¬†è¥¯è¡«é…é•·è¤² æ°£è³ª:å®‰éœæº«å’Œã€å¸¶æ›¸å·æ°£)' }, { code: 'M07', text: 'è—è¡“æ”¶è—ç³»(é«®å‹:æŸ”é †é•·åŠ‰æµ· æœè£:ç°¡ç´„è¥¯è¡«é…ç¾Šçµ¨åœå·¾ æ°£è³ª:ç´°è†©æµªæ¼«ã€ç•¥å¸¶ç¥ç§˜)' }, { code: 'M08', text: 'æ¸…çˆ½å­¸ç”Ÿç³»(é«®å‹:çŸ­è“¬é¬†é«® æœè£:é€£å¸½è¡›è¡£é…ç‰›ä»”è¤² æ°£è³ª:æ´»æ½‘é–‹æœ—ã€éš¨å’Œå¥½ç›¸è™•)' }, { code: 'M09', text: 'é„°å®¶æš–ç”·ç³»(é«®å‹:è‡ªç„¶çŸ­é«® æœè£:é‡ç¹”è¡«é…å¡å…¶è¤² æ°£è³ª:æº«æš–é«”è²¼ã€ç¬‘å®¹æŸ”å’Œ)' }, { code: 'M10', text: 'è¼•ç†Ÿä¼‘é–’ç³»(é«®å‹:ä¸­çŸ­ç›´é«® æœè£:POLOè¡«é…ä¼‘é–’è¤² æ°£è³ª:æˆç†Ÿç©©é‡ã€è¦ªåˆ‡éš¨å’Œ)' }, { code: 'M11', text: 'æ—¥ç³»ç°¡ç´„ç³»(é«®å‹:é †ç›´çŸ­é«® æœè£:å¯¬é¬†æ¯›è¡£é…ä¹åˆ†è¤² æ°£è³ª:ä¹¾æ·¨æ¸…çˆ½ã€è‡ªç„¶éš¨æ€§)' }, { code: 'M12', text: 'è¡—é ­æ½®æµç³»(é«®å‹:æŠ“è“¬çŸ­é«® æœè£:å¯¬é¬†Tæ¤é…å·¥è£è¤² æ°£è³ª:è‡ªä¿¡æ´»æ½‘ã€å¸¶é»ä¿çš®)' }
                ]
            },
            zodiac: [
                { code: 'Z01', text: 'ç™½ç¾Šåº§ (é™½å…‰ã€è¡å‹•ï¼Œæ„›å¾—ç›´æ¥ç†±çƒˆ)', symbol: 'â™ˆ' }, { code: 'Z02', text: 'é‡‘ç‰›åº§ (æˆç†Ÿã€å›ºåŸ·ï¼Œæ„Ÿæƒ…å°ˆä¸€ä½†ä½”æœ‰æ…¾å¼·)', symbol: 'â™‰' }, { code: 'Z03', text: 'é›™å­åº§ (è…¹é»‘ã€æ©Ÿéˆï¼Œæˆ€æ„›æ™‚å–œæ­¡è©¦æ¢å°æ–¹)', symbol: 'â™Š' }, { code: 'Z04', text: 'å·¨èŸ¹åº§ (ç—…å¬Œã€ä¾æˆ€ï¼Œå°æ„›æ¥µåº¦ä¾è³´)', symbol: 'â™‹' }, { code: 'Z05', text: 'ç…å­åº§ (é™½å…‰ã€éœ¸æ°£ï¼Œæ„›æ™‚é«˜èª¿å¼µæš)', symbol: 'â™Œ' }, { code: 'Z06', text: 'è™•å¥³åº§ (æˆç†Ÿã€æŒ‘å‰”ï¼Œå°æ„Ÿæƒ…è¬¹æ…è§€æœ›)', symbol: 'â™' }, { code: 'Z07', text: 'å¤©ç§¤åº§ (è…¹é»‘ã€å„ªé›…ï¼Œæˆ€æ„›ä¸­å¤–è¡¨æº«æŸ”é«”è²¼)', symbol: 'â™' }, { code: 'Z08', text: 'å¤©è åº§ (ç—…å¬Œã€ä½”æœ‰æ…¾å¼·ï¼Œæ„›å¾—æ·±æ²‰æ¥µç«¯)', symbol: 'â™' }, { code: 'Z09', text: 'å°„æ‰‹åº§ (é™½å…‰ã€ç‘è„«ï¼Œæ„›å¾—è‡ªç”±éš¨æ€§)', symbol: 'â™' }, { code: 'Z10', text: 'æ‘©ç¾¯åº§ (æˆç†Ÿã€ç†æ™ºï¼Œæ„Ÿæƒ…è¡¨é”å…§æ–‚)', symbol: 'â™‘' }, { code: 'Z11', text: 'æ°´ç“¶åº§ (è…¹é»‘ã€å¤æ€ªï¼Œæ„Ÿæƒ…ä¸­å¿½å†·å¿½ç†±)', symbol: 'â™’' }, { code: 'Z12', text: 'é›™é­šåº§ (ç—…å¬Œã€æ„Ÿæ€§ï¼Œæ„›æ™‚æ¥µåº¦æµªæ¼«ä¾æˆ€)', symbol: 'â™“' }
            ],
            bloodType: [
                { code: 'B01', text: 'è¡€å‹A (è¬¹æ…ç´°å¿ƒã€è²¬ä»»æ„Ÿå¼·)', symbol: 'ğŸ…°ï¸' }, { code: 'B02', text: 'è¡€å‹B (éš¨æ€§æ¨‚è§€ã€å‰µæ„å¤šè®Š)', symbol: 'ğŸ…±ï¸' }, { code: 'B03', text: 'è¡€å‹O (é–‹æœ—å¤–å‘ã€è¡Œå‹•åŠ›å¼·)', symbol: 'ğŸ…¾ï¸' }, { code: 'B04', text: 'è¡€å‹AB (ç†æ€§æ•æ„Ÿã€æ€ç¶­è·³èº)', symbol: 'ğŸ†' }
            ],
            intimacy: [
                { code: 'P01', text: 'æº«æŸ”æ…¢ç†±å‹ (é‡è¦–æƒ…æ„Ÿäº¤æµ)', symbol: 'ğŸ¥°' }, { code: 'P02', text: 'ä¸»å°æŒæ§å‹ (æŒæ¡ç¯€å¥)', symbol: 'ğŸ‘‘' }, { code: 'P03', text: 'ç†±æƒ…ä¸»å‹•å‹ (å……æ»¿æ¸´æœ›)', symbol: 'ğŸ”¥' }, { code: 'P04', text: 'æŒ‘é€—éŠæˆ²å‹ (å–„æ–¼æ’©æ’¥)', symbol: 'ğŸ˜' }, { code: 'P05', text: 'æ·±æƒ…çºç¶¿å‹ (é•·æ™‚é–“æ“æŠ±è¦ªå»)', symbol: 'ğŸ’' }, { code: 'P06', text: 'åå·®é©šå–œå‹ (å¹³æ™‚æ²‰ç©©ï¼Œè¦ªå¯†æ™‚å¼·çƒˆ)', symbol: 'ğŸ­' }, { code: 'P07', text: 'é«”è²¼é †æ‡‰å‹ (é…åˆå°æ–¹)', symbol: 'ğŸ¤—' }, { code: 'P08', text: 'æ¢ç´¢è®ŠåŒ–å‹ (å˜—è©¦æ–°äº‹ç‰©)', symbol: 'ğŸŒ' }, { code: 'P09', text: 'æƒ…ç·’ä¸»å°å‹ (æ„Ÿæ€§æ´¾)', symbol: 'ğŸŒŠ' }, { code: 'P10', text: 'å¼·çƒˆä½”æœ‰å‹ (å–œæ­¡å£“åˆ¶)', symbol: 'â›“ï¸' }
            ],
            profession: [
                { code: 'W01', text: 'ITå·¥ç¨‹å¸« (å¸¸åœ¨å®¶å·¥ä½œï¼Œä½œæ¯æ—¥å¤œé¡›å€’)', symbol: 'ğŸ’»' }, { code: 'W02', text: 'å’–å•¡å¸« (æ—©ç¡æ—©èµ·ï¼Œé•·æ™‚é–“å¾…åœ¨å»šæˆ¿)', symbol: 'â˜•' }, { code: 'W03', text: 'ç ”ç©¶ç”Ÿ (å¤šæ•¸æ™‚é–“åœ¨å­¸æ ¡æˆ–å¯¦é©—å®¤)', symbol: 'ğŸ“' }, { code: 'W04', text: 'å‰ä»–æ‰‹ (ä½œæ¯åæ™šï¼Œæ·±å¤œå‰µä½œ)', symbol: 'ğŸ¸' }, { code: 'W05', text: 'å¥èº«æ•™ç·´ (è¦å¾‹ä½œæ¯ï¼Œé•·æ™‚é–“åœ¨å¥èº«æˆ¿)', symbol: 'ğŸ’ª' }, { code: 'W06', text: 'ä½œå®¶ (å¤§éƒ¨åˆ†æ™‚é–“åœ¨å®¶ï¼Œä½œæ¯ä¸å›ºå®š)', symbol: 'âœï¸' }, { code: 'W07', text: 'é†«ç”Ÿ (ä½œæ¯æ··äº‚ï¼Œéš¨æ™‚å¯èƒ½è‡¨æ™‚å¤–å‡º)', symbol: 'ğŸ©º' }, { code: 'W08', text: 'èŠ±è—å¸« (æ—©èµ·å·¥ä½œï¼Œç¶“å¸¸æ¥è§¸æ¤ç‰©)', symbol: 'ğŸ’' }, { code: 'W09', text: 'è¨­è¨ˆå¸« (å¸¸åœ¨å®¶æˆ–å·¥ä½œå®¤åŠ ç­)', symbol: 'ğŸ¨' }, { code: 'W10', text: 'æ”å½±å¸« (å¤–å‡ºæ‹æ”é »ç¹ï¼Œæ—¥å¤œä½œæ¯ä¸å›ºå®š)', symbol: 'ğŸ“·' }, { code: 'W11', text: 'åœ‹å°è€å¸« (æ—©ç¡æ—©èµ·ï¼Œä½œæ¯ç©©å®š)', symbol: 'ğŸ«' }, { code: 'W12', text: 'æ¥­å‹™ (å¤–å‹¤æ™‚é–“å¤šï¼Œç¶“å¸¸éœ€è¦èˆ‡å®¢æˆ¶æ‡‰é…¬)', symbol: 'ğŸ‘”' }
            ],
            initialRelationship: [
                { code: 'S01', text: 'å®Œå…¨çš„é™Œç”Ÿäºº (å¥½æ„Ÿåº¦:50 / é€Ÿåº¦:+15)' }, 
                { code: 'S02', text: 'æœ‹å‹çš„æœ‹å‹ (å¥½æ„Ÿåº¦:150 / é€Ÿåº¦:+30)' }, 
                { code: 'S03', text: 'å­¸ç”Ÿæ™‚ä»£çš„å­¸é•·å­¸å§Š (å¥½æ„Ÿåº¦:200 / é€Ÿåº¦:+15)' }, 
                { code: 'S04', text: 'ä»¥å‰çš„åŒäº‹ (å¥½æ„Ÿåº¦:180 / é€Ÿåº¦:+15)' }, 
                { code: 'S05', text: 'è¨±ä¹…æœªè¦‹çš„é æˆ¿è¦ªæˆš (å¥½æ„Ÿåº¦:100 / é€Ÿåº¦:+5)' }, 
                { code: 'S06', text: 'äº¤å‹ç¶²ç«™çš„ç¶²å‹ (å¥½æ„Ÿåº¦:250 / é€Ÿåº¦:+30)' }, 
                { code: 'S07', text: 'åˆ†æ‰‹ä¸ä¹…çš„å‰ä»» (å¥½æ„Ÿåº¦:-150 / é€Ÿåº¦:+5)' }, 
                { code: 'S08', text: 'ä½ æ›¾ç¶“æš—æˆ€çš„å°è±¡ (å¥½æ„Ÿåº¦:150 / é€Ÿåº¦:+15)' }, 
                { code: 'S09', text: 'æ­»æ•µ (å¥½æ„Ÿåº¦:-1500 / é€Ÿåº¦:+3)' }, 
                { code: 'S10', text: 'å•†æ¥­ç«¶çˆ­å°æ‰‹ (å¥½æ„Ÿåº¦:-1000 / é€Ÿåº¦:+5)' }, 
                { code: 'S11', text: 'æ›¾ç¶“ä¸€å¤œæƒ… (å¥½æ„Ÿåº¦:200 / é€Ÿåº¦:+30)' }
            ]
        };

        // --- SCRIPT LOGIC ---
        let currentStep = 1;
        const totalSteps = 6; 

        function populateTextCards(containerId, data, name, isCheckedFirst = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            data.forEach((item, index) => {
                const label = document.createElement('label');
                label.className = 'text-card-label';
                const checked = (isCheckedFirst && index === 0) ? 'checked' : '';
                label.innerHTML = `
                    <input type="radio" name="${name}" value="${item.code}" class="hidden" ${checked}>
                    <div class="text-card-content">
                        <span class="text-sm text-card-text">${item.text}</span>
                    </div>
                `;
                container.appendChild(label);
            });
        }
        
        function populateCards(containerId, data, name, isCheckedFirst = false, cardType = 'appearance') {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            data.forEach((item, index) => {
                const label = document.createElement('label');
                label.className = 'card-label';
                const checked = (isCheckedFirst && index === 0) ? 'checked' : '';
                const title = item.text.split('(')[0].trim();
                const desc = item.text.includes('(') ? item.text.substring(item.text.indexOf('(') + 1, item.text.lastIndexOf(')')) : '';
                
                let visualElement = '';
                if (cardType === 'zodiac') {
                    visualElement = `<div class="zodiac-emoji">${item.symbol || '?'}</div>`;
                } else if (cardType === 'icon') {
                    visualElement = `<div class="icon-emoji">${item.symbol || '?'}</div>`;
                } else { // appearance
                    const imagePath = `images/${item.code}.png`;
                    const fallbackImage = `https://placehold.co/400x400/2a2a2a/EAEAEA?text=${encodeURIComponent(title)}`;
                    visualElement = `<img src="${imagePath}" alt="${title}" onerror="this.onerror=null;this.src='${fallbackImage}';">`;
                }

                label.innerHTML = `
                    <input type="radio" name="${name}" value="${item.code}" class="hidden" ${checked}>
                    <div class="card">
                        ${visualElement}
                        <div class="card-content">
                            <p class="card-title">${title}</p>
                            ${desc ? `<p class="card-desc">${desc.replace(/ /g, '<br>')}</p>` : ''}
                        </div>
                        <div class="check-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16" style="color: var(--text-dark);">
                                <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                            </svg>
                        </div>
                    </div>
                `;
                container.appendChild(label);
            });
        }

        function updateAppearanceOptions(genderRadioName, appearanceContainerId) {
            const genderRadio = document.querySelector(`input[name="${genderRadioName}"]:checked`);
            if (!genderRadio) return;
            const gender = genderRadio.value;
            const appearanceOptions = gender === 'G01' ? gameData.appearance.male : gameData.appearance.female;
            populateCards(appearanceContainerId, appearanceOptions, appearanceContainerId, true, 'appearance');
        }

        function updateRoommateGenderOptions() {
            const playerSexuality = getRadioValue('playerSexuality');
            let filteredGenders = gameData.gender;
            if (playerSexuality === 'X01') {
                filteredGenders = gameData.gender.filter(g => g.code === 'G01');
            } else if (playerSexuality === 'X02') {
                filteredGenders = gameData.gender.filter(g => g.code === 'G02');
            }
            populateCards('roommateGender', filteredGenders, 'roommateGender', true, 'icon');
            updateAppearanceOptions('roommateGender', 'roommateAppearance');
        }

        function initializeForm() {
            populateCards('playerGender', gameData.gender, 'playerGender', true, 'icon');
            populateCards('playerSexuality', gameData.sexuality, 'playerSexuality', true, 'icon');
            populateCards('playerZodiac', gameData.zodiac, 'playerZodiac', true, 'zodiac');
            populateCards('playerBloodType', gameData.bloodType, 'playerBloodType', true, 'icon');
            updateAppearanceOptions('playerGender', 'playerAppearance');
            
            populateCards('roommateZodiac', gameData.zodiac, 'roommateZodiac', true, 'zodiac');
            populateCards('roommateBloodType', gameData.bloodType, 'roommateBloodType', true, 'icon');
            populateCards('roommateProfession', gameData.profession, 'roommateProfession', true, 'icon');
            populateCards('roommateIntimacy', gameData.intimacy, 'roommateIntimacy', true, 'icon');
            populateTextCards('initialRelationship', gameData.initialRelationship, 'initialRelationship', true);
            
            updateRoommateGenderOptions();

            document.getElementById('playerGender').addEventListener('change', () => updateAppearanceOptions('playerGender', 'playerAppearance'));
            document.getElementById('playerSexuality').addEventListener('change', updateRoommateGenderOptions);
            document.getElementById('roommateGender').addEventListener('change', () => updateAppearanceOptions('roommateGender', 'roommateAppearance'));
        }
        
        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById(`step-${stepNumber}`).classList.add('active');
            window.scrollTo(0, 0);
        }

        function goToStep(stepNumber) {
            currentStep = stepNumber;
            showStep(currentStep);
        }

        function validateStep(stepNumber) {
            const stepElement = document.getElementById(`step-${stepNumber}`);
            const errorMessageElement = stepElement.querySelector('.error-message');
            
            if (errorMessageElement) errorMessageElement.textContent = '';
            
            stepElement.querySelectorAll('input.invalid').forEach(input => {
                input.classList.remove('invalid');
            });

            const textInputs = stepElement.querySelectorAll('input[type="text"]');
            for (const input of textInputs) {
                if (!input.value.trim()) {
                    input.classList.add('invalid');
                    if (errorMessageElement) {
                        const label = document.querySelector(`label[for="${input.id}"]`);
                        const fieldName = label ? label.textContent : 'å¿…å¡«æ¬„ä½';
                        errorMessageElement.textContent = `è«‹å¡«å¯«ã€Œ${fieldName}ã€ï¼`;
                    }
                    return false; 
                }
            }
            return true;
        }

        function nextStep() {
            if (!validateStep(currentStep)) return;

            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        }
        
        function showSummary() {
            if (!validateStep(currentStep)) return;
            updateSummaryPage();
            const output = generateFinalOutput();
            document.getElementById('summary-output').textContent = output;
            nextStep();
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function getRadioValue(name) {
            const checkedRadio = document.querySelector(`input[name="${name}"]:checked`);
            return checkedRadio ? checkedRadio.value : '';
        }

        function findDataItem(dataArray, code) {
            return dataArray.find(item => item.code === code) || { text: 'N/A' };
        }

        function updateSummaryPage() {
            const data = getAllSelections();
            const container = document.getElementById('summary-visual');

            const playerApp = data.playerGender.code === 'G01' 
                ? findDataItem(gameData.appearance.male, data.playerAppearance.code) 
                : findDataItem(gameData.appearance.female, data.playerAppearance.code);

            const roommateApp = data.roommateGender.code === 'G01'
                ? findDataItem(gameData.appearance.male, data.roommateAppearance.code)
                : findDataItem(gameData.appearance.female, data.roommateAppearance.code);

            container.innerHTML = `
                <div class="summary-card">
                    <h3 class="summary-title">ç©å®¶</h3>
                    <img src="images/${data.playerAppearance.code}.png" alt="${playerApp.text.split('(')[0]}" onerror="this.onerror=null;this.src='https://placehold.co/400x400/2a2a2a/EAEAEA?text=Player';">
                    <div class="summary-details">
                        <p><span>å§“å:</span> ${data.playerName}</p>
                        <p><span>æ€§åˆ¥:</span> ${data.playerGender.text}</p>
                        <p><span>æ€§å‘:</span> ${data.playerSexuality.text}</p>
                        <p><span>å¤–è§€:</span> ${playerApp.text.split('(')[0]}</p>
                        <p><span>æ˜Ÿåº§:</span> ${data.playerZodiac.text.split('(')[0]}</p>
                        <p><span>è¡€å‹:</span> ${data.playerBloodType.text.split('(')[0]}</p>
                    </div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-title">å®¤å‹</h3>
                    <img src="images/${data.roommateAppearance.code}.png" alt="${roommateApp.text.split('(')[0]}" onerror="this.onerror=null;this.src='https://placehold.co/400x400/2a2a2a/EAEAEA?text=Roommate';">
                    <div class="summary-details">
                        <p><span>å§“å:</span> ${data.roommateName}</p>
                        <p><span>æ€§åˆ¥:</span> ${data.roommateGender.text}</p>
                        <p><span>è·æ¥­:</span> ${data.roommateProfession.text.split('(')[0]}</p>
                        <p><span>å¤–è§€:</span> ${roommateApp.text.split('(')[0]}</p>
                        <p><span>æ˜Ÿåº§:</span> ${data.roommateZodiac.text.split('(')[0]}</p>
                        <p><span>è¡€å‹:</span> ${data.roommateBloodType.text.split('(')[0]}</p>
                    </div>
                </div>
            `;
        }
        
        function getAllSelections() {
             return {
                playerName: document.getElementById('playerName').value,
                playerGender: findDataItem(gameData.gender, getRadioValue('playerGender')),
                playerSexuality: findDataItem(gameData.sexuality, getRadioValue('playerSexuality')),
                playerZodiac: findDataItem(gameData.zodiac, getRadioValue('playerZodiac')),
                playerBloodType: findDataItem(gameData.bloodType, getRadioValue('playerBloodType')),
                playerAppearance: { code: getRadioValue('playerAppearance') },
                roommateName: document.getElementById('roommateName').value,
                roommateGender: findDataItem(gameData.gender, getRadioValue('roommateGender')),
                roommateZodiac: findDataItem(gameData.zodiac, getRadioValue('roommateZodiac')),
                roommateBloodType: findDataItem(gameData.bloodType, getRadioValue('roommateBloodType')),
                roommateProfession: findDataItem(gameData.profession, getRadioValue('roommateProfession')),
                roommateAppearance: { code: getRadioValue('roommateAppearance') },
                roommateIntimacy: findDataItem(gameData.intimacy, getRadioValue('roommateIntimacy')),
                initialRelationship: findDataItem(gameData.initialRelationship, getRadioValue('initialRelationship')),
                roommateNickname: document.getElementById('roommateNickname').value,
            };
        }

        function generateFinalOutput() {
            const data = getAllSelections();

            const playerApp = data.playerGender.code === 'G01' 
                ? findDataItem(gameData.appearance.male, data.playerAppearance.code) 
                : findDataItem(gameData.appearance.female, data.playerAppearance.code);

            const roommateApp = data.roommateGender.code === 'G01'
                ? findDataItem(gameData.appearance.male, data.roommateAppearance.code)
                : findDataItem(gameData.appearance.female, data.roommateAppearance.code);

            const playerID = `UR-${data.playerGender.code}${data.playerAppearance.code}${data.playerZodiac.code}${data.playerBloodType.code}-${data.playerSexuality.code}W13`;
            const roommateID = `PL-${data.roommateGender.code}${data.roommateAppearance.code}${data.roommateZodiac.code}${data.roommateBloodType.code}-${data.roommateIntimacy.code}${data.roommateProfession.code}${data.initialRelationship.code}`;

            const output = `--- ç©å®¶è¨­å®š ---
å§“å: ${data.playerName}
ç¨±å‘¼: ${data.roommateNickname}
èº«ä»½è™Ÿ: ${playerID}
æ€§åˆ¥: ${data.playerGender.text}
æ€§å‘: ${data.playerSexuality.text}
å¤–è§€: ${playerApp.text}
æ˜Ÿåº§: ${data.playerZodiac.text}
è¡€å‹: ${data.playerBloodType.text}

--- å®¤å‹è¨­å®š ---
å§“å: ${data.roommateName}
èº«ä»½è™Ÿ: ${roommateID}
æ€§åˆ¥: ${data.roommateGender.text}
å¤–è§€: ${roommateApp.text}
æ˜Ÿåº§: ${data.roommateZodiac.text}
è¡€å‹: ${data.roommateBloodType.text}
è·æ¥­: ${data.roommateProfession.text}
åˆå§‹é—œä¿‚: ${data.initialRelationship.text}
è¦ªå¯†è¡Œç‚ºé¢¨æ ¼: ${data.roommateIntimacy.text}`;
            
            return output.trim();
        }

        function downloadTxt() {
            const text = document.getElementById('summary-output').textContent;
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'RoommateLoveGuide_Settings.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        document.addEventListener('DOMContentLoaded', initializeForm);
    </script>

</body>
</html>
